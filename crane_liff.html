<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèóÔ∏è Crane System - LIFF App</title>
    <script src="https://static.line-scdn.net/liff/edge/versions/2.22.3/sdk.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        .liff-button {
            background: #00B900;
            color: white;
            border-radius: 12px;
            padding: 14px 20px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            margin: 8px 0;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <div id="header" class="bg-green-600 text-white p-4 text-center">
        <h1 class="text-2xl font-bold">üèóÔ∏è Crane System</h1>
        <p class="text-green-100">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
    </div>

    <!-- Main Content (‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å LIFF ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô) -->
    <div id="main-content" class="hidden">
        <!-- User Info -->
        <div class="bg-white p-4 border-b">
            <div class="flex items-center space-x-3">
                <img id="user-picture" src="" class="w-12 h-12 rounded-full">
                <div>
                    <div id="user-name" class="font-semibold"></div>
                    <div id="user-status" class="text-sm text-gray-600"></div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="p-4 space-y-3">
            <button onclick="bookCrane()" class="w-full liff-button">
                üìû ‡∏à‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏ô
            </button>
            
            <button onclick="viewSchedule()" class="w-full liff-button" style="background: #0066CC;">
                üìÖ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
            </button>
            
            <button onclick="shareApp()" class="w-full liff-button" style="background: #FF6B00;">
                üîó ‡πÅ‡∏ä‡∏£‡πå‡πÅ‡∏≠‡∏õ
            </button>
            
            <button onclick="openMap()" class="w-full liff-button" style="background: #666666;">
                üó∫Ô∏è ‡∏î‡∏π‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
            </button>
        </div>

        <!-- Booking Form -->
        <div class="bg-white m-4 rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-bold mb-4">üìù ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡∏¢‡∏Å‡πÉ‡∏´‡∏°‡πà</h2>
            <form onsubmit="submitJob(event)" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô</label>
                    <input type="text" id="jobName" required 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md"
                        placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏¢‡∏Å‡πÄ‡∏™‡∏≤‡πÄ‡∏Ç‡πá‡∏°, ‡∏¢‡∏Å‡∏Ñ‡∏≤‡∏ô‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï">
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (‡∏ï‡∏±‡∏ô)</label>
                        <select id="jobWeight" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            <option value="0.5">0.5 ‡∏ï‡∏±‡∏ô</option>
                            <option value="1.0" selected>1.0 ‡∏ï‡∏±‡∏ô</option>
                            <option value="1.5">1.5 ‡∏ï‡∏±‡∏ô</option>
                            <option value="2.0">2.0 ‡∏ï‡∏±‡∏ô</option>
                            <option value="2.5">2.5 ‡∏ï‡∏±‡∏ô</option>
                            <option value="3.0">3.0 ‡∏ï‡∏±‡∏ô</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô</label>
                        <select id="jobType" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            <option value="steel">‡πÄ‡∏´‡∏•‡πá‡∏Å</option>
                            <option value="concrete">‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï</option>
                            <option value="equipment">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</option>
                            <option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium mb-2">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                    <textarea id="jobNote" rows="2"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md"
                        placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏£‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà, ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏ß‡∏•‡∏≤"></textarea>
                </div>

                <button type="submit" class="w-full liff-button">
                    ‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏¢‡∏Å
                </button>
            </form>
        </div>

        <!-- Recent Jobs -->
        <div class="bg-white m-4 rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-bold mb-4">üìã ‡∏á‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h2>
            <div id="recentJobs">
                <div class="text-center text-gray-500 py-4">
                    ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô
                </div>
            </div>
        </div>
    </div>

    <!-- Loading -->
    <div id="loading" class="flex items-center justify-center min-h-48">
        <div class="text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto"></div>
            <p class="mt-4 text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î Crane System...</p>
        </div>
    </div>

    <script>
        // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        let userProfile = null;
        let jobs = [];

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô LIFF App
        async function initializeLiff() {
            try {
                // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô YOUR_LIFF_ID ‡πÄ‡∏õ‡πá‡∏ô LIFF ID ‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
                await liff.init({ liffId: '2008208969-VxvXR048' });
                
                if (!liff.isLoggedIn()) {
                    liff.login();
                    return;
                }

                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                userProfile = await liff.getProfile();
                displayUserInfo();
                
                // ‡∏ã‡πà‡∏≠‡∏ô loading, ‡πÅ‡∏™‡∏î‡∏á content
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('main-content').classList.remove('hidden');
                
                console.log('LIFF initialized successfully');
                
            } catch (error) {
                console.error('LIFF initialization failed', error);
                document.getElementById('loading').innerHTML = `
                    <div class="text-center text-red-600">
                        <p>‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</p>
                        <p class="text-sm">${error.message}</p>
                        <button onclick="location.reload()" class="mt-4 px-4 py-2 bg-green-600 text-white rounded">
                            ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà
                        </button>
                    </div>
                `;
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
        function displayUserInfo() {
            document.getElementById('user-picture').src = userProfile.pictureUrl;
            document.getElementById('user-name').textContent = userProfile.displayName;
            document.getElementById('user-status').textContent = '‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
        }

        // ‡∏à‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏ô
        async function bookCrane() {
            // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('jobName').scrollIntoView({ behavior: 'smooth' });
            document.getElementById('jobName').focus();
        }

        // ‡∏î‡∏π‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏á‡∏≤‡∏ô
        async function viewSchedule() {
            const message = `üìÖ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ\n\n` +
                          `üü¢ ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£: 2 ‡∏á‡∏≤‡∏ô\n` +
                          `üü° ‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô: 1 ‡∏á‡∏≤‡∏ô\n` +
                          `‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏ß‡∏°: 4.5 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á`;
            
            await sendMessage(message);
        }

        // ‡πÅ‡∏ä‡∏£‡πå‡πÅ‡∏≠‡∏õ
        async function shareApp() {
            if (liff.isApiAvailable('shareTargetPicker')) {
                try {
                    await liff.shareTargetPicker([
                        {
                            type: 'text',
                            text: `üèóÔ∏è ‡πÉ‡∏ä‡πâ Crane System ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏¢‡∏Å\n\n` +
                                  `‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏ô ‡∏î‡∏π‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡πÜ\n` +
                                  `‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏¢!`
                        }
                    ]);
                } catch (error) {
                    console.log('Share cancelled');
                }
            } else {
                alert('‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ');
            }
        }

        // ‡∏î‡∏π‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
        function openMap() {
            liff.openWindow({
                url: 'https://www.google.com/maps',
                external: true
            });
        }

        // ‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
        async function submitJob(event) {
            event.preventDefault();
            
            const jobData = {
                name: document.getElementById('jobName').value,
                weight: document.getElementById('jobWeight').value,
                type: document.getElementById('jobType').value,
                note: document.getElementById('jobNote').value,
                user: userProfile.displayName,
                timestamp: new Date().toLocaleString('th-TH')
            };

            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
            jobs.unshift({
                id: 'J' + (jobs.length + 1),
                ...jobData,
                status: 'pending'
            });

            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó UI
            updateRecentJobs();
            
            // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            const message = `üìã ‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà!\n\n` +
                          `‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô: ${jobData.name}\n` +
                          `‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å: ${jobData.weight} ‡∏ï‡∏±‡∏ô\n` +
                          `‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${jobData.type}\n` +
                          `‡∏ú‡∏π‡πâ‡∏Ç‡∏≠: ${jobData.user}\n` +
                          `‡πÄ‡∏ß‡∏•‡∏≤: ${jobData.timestamp}`;
            
            await sendMessage(message);
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
            event.target.reset();
            
            // ‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏•
            alert('‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏¢‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
        function updateRecentJobs() {
            const container = document.getElementById('recentJobs');
            
            if (jobs.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô</div>';
                return;
            }
            
            container.innerHTML = jobs.slice(0, 5).map(job => `
                <div class="border-b pb-3 mb-3">
                    <div class="flex justify-between items-start">
                        <div class="font-semibold">${job.name}</div>
                        <span class="px-2 py-1 rounded text-xs ${
                            job.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 
                            'bg-green-100 text-green-800'
                        }">
                            ${job.status === 'pending' ? '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£' : '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô'}
                        </span>
                    </div>
                    <div class="text-sm text-gray-600 mt-1">
                        ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å: ${job.weight}t | ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${job.type}
                    </div>
                    <div class="text-xs text-gray-500 mt-1">
                        ‡πÇ‡∏î‡∏¢ ${job.user} ‚Ä¢ ${job.timestamp}
                    </div>
                </div>
            `).join('');
        }

        // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        async function sendMessage(message) {
            if (liff.isInClient()) {
                try {
                    await liff.sendMessages([{ type: 'text', text: message }]);
                } catch (error) {
                    console.error('Send message failed', error);
                }
            } else {
                // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô LINE Client ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô alert
                alert(message);
            }
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
        document.addEventListener('DOMContentLoaded', initializeLiff);
    </script>
</body>
</html>
