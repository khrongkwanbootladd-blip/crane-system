<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèóÔ∏è Crane System</title>
    <script src="https://static.line-scdn.net/liff/edge/versions/2.22.3/sdk.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        .container {
            max-width: 100%;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .header {
            background: linear-gradient(135deg, #00B900, #009900);
            color: white;
            padding: 25px;
            text-align: center;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        .button {
            background: #00B900;
            color: white;
            border: none;
            padding: 16px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            margin: 10px 0;
            cursor: pointer;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        .form-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e1e1;
            border-radius: 8px;
            font-size: 16px;
        }
        .job-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #00B900;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üèóÔ∏è Crane System</h1>
            <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏£‡∏ô‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</p>
        </div>

        <!-- Loading -->
        <div id="loading" class="loading">
            <div>üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏∞‡∏ö‡∏ö...</div>
        </div>

        <!-- Main Content -->
        <div id="mainContent" style="display: none;">
            <!-- Quick Actions -->
            <button class="button" onclick="bookCrane()">üìû ‡∏à‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏ô</button>
            <button class="button" style="background: #0066CC;" onclick="viewSchedule()">üìÖ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏á‡∏≤‡∏ô</button>
            <button class="button" style="background: #FF6B00;" onclick="shareApp()">üîó ‡πÅ‡∏ä‡∏£‡πå‡πÅ‡∏≠‡∏õ</button>

            <!-- Booking Form -->
            <div style="margin: 20px 0;">
                <h2 style="margin-bottom: 15px;">üìù ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h2>
                <form onsubmit="submitJob(event)">
                    <div class="form-group">
                        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô</label>
                        <input type="text" id="jobName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏¢‡∏Å‡πÄ‡∏™‡∏≤‡πÄ‡∏Ç‡πá‡∏°, ‡∏¢‡∏Å‡∏Ñ‡∏≤‡∏ô‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï" required>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div class="form-group">
                            <label>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (‡∏ï‡∏±‡∏ô)</label>
                            <select id="jobWeight">
                                <option value="0.5">0.5 ‡∏ï‡∏±‡∏ô</option>
                                <option value="1.0" selected>1.0 ‡∏ï‡∏±‡∏ô</option>
                                <option value="1.5">1.5 ‡∏ï‡∏±‡∏ô</option>
                                <option value="2.0">2.0 ‡∏ï‡∏±‡∏ô</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô</label>
                            <select id="jobType">
                                <option value="steel">‡∏á‡∏≤‡∏ô‡πÄ‡∏´‡∏•‡πá‡∏Å</option>
                                <option value="concrete">‡∏á‡∏≤‡∏ô‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï</option>
                                <option value="equipment">‡∏¢‡πâ‡∏≤‡∏¢‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                        <textarea id="jobNote" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏£‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà, ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏ß‡∏•‡∏≤" rows="2"></textarea>
                    </div>

                    <button type="submit" class="button">‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏¢‡∏Å</button>
                </form>
            </div>

            <!-- Recent Jobs -->
            <div>
                <h2 style="margin-bottom: 15px;">üìã ‡∏á‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h2>
                <div id="recentJobs">
                    <div style="text-align: center; color: #666; padding: 30px;">
                        ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        let userProfile = null;
        let jobs = [];

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô LIFF App
        async function initializeLiff() {
            try {
                console.log('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô LIFF...');
                
                // üî• ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô LIFF ID ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì! üî•
                await liff.init({ 
                    liffId: '2008208969-VxvXR048'  // ‡πÉ‡∏™‡πà LIFF ID ‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
                });
                
                console.log('LIFF ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');

                if (!liff.isLoggedIn()) {
                    liff.login();
                    return;
                }

                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                userProfile = await liff.getProfile();
                
                // ‡∏ã‡πà‡∏≠‡∏ô loading, ‡πÅ‡∏™‡∏î‡∏á content
                document.getElementById('loading').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                
            } catch (error) {
                console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:', error);
                document.getElementById('loading').innerHTML = `
                    <div style="color: red; text-align: center;">
                        <p>‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</p>
                        <p>${error.message}</p>
                        <button onclick="location.reload()" style="margin-top: 16px; padding: 10px 20px; background: #00B900; color: white; border: none; border-radius: 8px;">
                            ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà
                        </button>
                    </div>
                `;
            }
        }

        // ‡∏à‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏ô
        function bookCrane() {
            document.getElementById('jobName').scrollIntoView({ behavior: 'smooth' });
            document.getElementById('jobName').focus();
        }

        // ‡∏î‡∏π‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏á‡∏≤‡∏ô
        async function viewSchedule() {
            const message = `üìÖ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ\n\n` +
                          `‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß: 2 ‡∏á‡∏≤‡∏ô\n` +
                          `üü° ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥: 1 ‡∏á‡∏≤‡∏ô\n` +
                          `‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏ß‡∏°: 3.5 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á\n\n` +
                          `‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡∏¢!`;
            
            if (liff.isInClient()) {
                await liff.sendMessages([{ type: 'text', text: message }]);
            } else {
                alert(message);
            }
        }

        // ‡πÅ‡∏ä‡∏£‡πå‡πÅ‡∏≠‡∏õ
        async function shareApp() {
            if (liff.isApiAvailable('shareTargetPicker')) {
                try {
                    await liff.shareTargetPicker([
                        {
                            type: 'text',
                            text: `üèóÔ∏è ‡πÉ‡∏ä‡πâ Crane System ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏¢‡∏Å\n\n` +
                                  `‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏ô ‡∏î‡∏π‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡πÜ\n` +
                                  `‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏¢!`
                        }
                    ]);
                } catch (error) {
                    console.log('‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå');
                }
            } else {
                alert('‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
            }
        }

        // ‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
        async function submitJob(event) {
            event.preventDefault();
            
            const jobName = document.getElementById('jobName').value;
            const jobWeight = document.getElementById('jobWeight').value;
            const jobType = document.getElementById('jobType').value;
            const jobNote = document.getElementById('jobNote').value;

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
            const newJob = {
                id: 'J' + (jobs.length + 1),
                name: jobName,
                weight: jobWeight,
                type: jobType,
                note: jobNote,
                timestamp: new Date().toLocaleString('th-TH'),
                status: 'pending'
            };

            jobs.unshift(newJob);
            updateJobList();
            
            // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
            const message = `üìã ‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà!\n\n` +
                          `‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô: ${jobName}\n` +
                          `‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å: ${jobWeight} ‡∏ï‡∏±‡∏ô\n` +
                          `‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${getJobTypeText(jobType)}\n` +
                          `‡πÄ‡∏ß‡∏•‡∏≤: ${newJob.timestamp}` +
                          (jobNote ? `\n‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${jobNote}` : '');
            
            if (liff.isInClient()) {
                await liff.sendMessages([{ type: 'text', text: message }]);
            }
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
            event.target.reset();
            
            alert('‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏¢‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô
        function updateJobList() {
            const container = document.getElementById('recentJobs');
            
            if (jobs.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 30px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô</div>';
                return;
            }
            
            container.innerHTML = jobs.slice(0, 3).map(job => `
                <div class="job-item">
                    <div style="font-weight: bold; font-size: 16px;">${job.name}</div>
                    <div style="color: #666; margin: 5px 0;">
                        ${job.weight} ‡∏ï‡∏±‡∏ô ‚Ä¢ ${getJobTypeText(job.type)}
                    </div>
                    <div style="color: #999; font-size: 12px;">
                        ${job.timestamp} ‚Ä¢ 
                        <span style="color: #f59e0b;">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>
                    </div>
                </div>
            `).join('');
        }

        // ‡πÅ‡∏õ‡∏•‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô
        function getJobTypeText(type) {
            const types = {
                'steel': '‡∏á‡∏≤‡∏ô‡πÄ‡∏´‡∏•‡πá‡∏Å',
                'concrete': '‡∏á‡∏≤‡∏ô‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï', 
                'equipment': '‡∏¢‡πâ‡∏≤‡∏¢‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå'
            };
            return types[type] || type;
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
        document.addEventListener('DOMContentLoaded', initializeLiff);
    </script>
</body>
</html>
