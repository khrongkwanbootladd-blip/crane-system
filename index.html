<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèóÔ∏è Crane System</title>
    <script src="https://static.line-scdn.net/liff/edge/versions/2.22.3/sdk.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f5f5f5;
            max-width: 100%;
            overflow-x: hidden;
        }
        .container {
            max-width: 100%;
            padding: 16px;
        }
        .header {
            background: linear-gradient(135deg, #00B900, #009900);
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 0 0 20px 20px;
            margin: -8px -8px 20px -8px;
        }
        .button {
            background: #00B900;
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            margin: 8px 0;
            cursor: pointer;
        }
        .card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin: 16px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: white;
            border-radius: 12px;
            margin: 16px 0;
        }
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
        }
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin: 8px 0;
        }
        .job-item {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }
        .status-pending { color: #f59e0b; }
        .status-completed { color: #10b981; }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>üèóÔ∏è Crane System</h1>
        <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏£‡∏ô‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</p>
    </div>

    <div class="container">
        <!-- Loading -->
        <div id="loading" class="loading">
            <div>üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
        </div>

        <!-- Main Content -->
        <div id="mainContent" style="display: none;">
            <!-- User Info -->
            <div class="user-info">
                <img id="userAvatar" class="user-avatar">
                <div>
                    <div id="userName" style="font-weight: bold;"></div>
                    <div id="userStatus" style="color: #666; font-size: 14px;">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>
                </div>
            </div>

            <!-- Quick Actions -->
            <button class="button" onclick="bookCrane()">üìû ‡∏à‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏ô</button>
            <button class="button" style="background: #0066CC;" onclick="viewSchedule()">üìÖ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏á‡∏≤‡∏ô</button>
            <button class="button" style="background: #FF6B00;" onclick="shareApp()">üîó ‡πÅ‡∏ä‡∏£‡πå‡πÅ‡∏≠‡∏õ</button>

            <!-- Booking Form -->
            <div class="card">
                <h2 style="margin-bottom: 16px;">üìù ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h2>
                <form onsubmit="submitJob(event)">
                    <input type="text" id="jobName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ‡∏¢‡∏Å‡πÄ‡∏™‡∏≤‡πÄ‡∏Ç‡πá‡∏°)" required>
                    
                    <select id="jobWeight">
                        <option value="0.5">0.5 ‡∏ï‡∏±‡∏ô</option>
                        <option value="1.0" selected>1.0 ‡∏ï‡∏±‡∏ô</option>
                        <option value="1.5">1.5 ‡∏ï‡∏±‡∏ô</option>
                        <option value="2.0">2.0 ‡∏ï‡∏±‡∏ô</option>
                    </select>

                    <select id="jobType">
                        <option value="steel">‡∏á‡∏≤‡∏ô‡πÄ‡∏´‡∏•‡πá‡∏Å</option>
                        <option value="concrete">‡∏á‡∏≤‡∏ô‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï</option>
                        <option value="equipment">‡∏¢‡πâ‡∏≤‡∏¢‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</option>
                    </select>

                    <textarea id="jobNote" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)" rows="2"></textarea>

                    <button type="submit" class="button">‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏¢‡∏Å</button>
                </form>
            </div>

            <!-- Recent Jobs -->
            <div class="card">
                <h2 style="margin-bottom: 16px;">üìã ‡∏á‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h2>
                <div id="recentJobs">
                    <div style="text-align: center; color: #666; padding: 20px;">
                        ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        let userProfile = null;
        let jobs = [];

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô LIFF App
        async function initializeLiff() {
            try {
                console.log('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô LIFF...');
                
                // üî• ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô LIFF ID ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì! üî•
                await liff.init({ 
                    liffId: '2008208969-VxvXR048'  // ‡πÉ‡∏™‡πà LIFF ID ‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
                });
                
                console.log('LIFF ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');

                if (!liff.isLoggedIn()) {
                    console.log('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô, ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô...');
                    liff.login();
                    return;
                }

                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                userProfile = await liff.getProfile();
                console.log('‡πÑ‡∏î‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:', userProfile);
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                showUserInfo();
                
                // ‡∏ã‡πà‡∏≠‡∏ô loading, ‡πÅ‡∏™‡∏î‡∏á content
                document.getElementById('loading').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                
            } catch (error) {
                console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:', error);
                document.getElementById('loading').innerHTML = `
                    <div style="color: red;">
                        <p>‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</p>
                        <p>${error.message}</p>
                        <button onclick="location.reload()" style="margin-top: 16px; padding: 8px 16px; background: #00B900; color: white; border: none; border-radius: 8px;">
                            ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà
                        </button>
                    </div>
                `;
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
        function showUserInfo() {
            document.getElementById('userAvatar').src = userProfile.pictureUrl;
            document.getElementById('userName').textContent = userProfile.displayName;
        }

        // ‡∏à‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏ô
        function bookCrane() {
            document.getElementById('jobName').scrollIntoView({ behavior: 'smooth' });
            document.getElementById('jobName').focus();
        }

        // ‡∏î‡∏π‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏á‡∏≤‡∏ô
        async function viewSchedule() {
            const message = `üìÖ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ\n\n` +
                          `‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß: 2 ‡∏á‡∏≤‡∏ô\n` +
                          `üü° ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥: 1 ‡∏á‡∏≤‡∏ô\n` +
                          `‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏ß‡∏°: 3.5 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á\n\n` +
                          `‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡∏¢!`;
            
            await sendMessage(message);
        }

        // ‡πÅ‡∏ä‡∏£‡πå‡πÅ‡∏≠‡∏õ
        async function shareApp() {
            if (liff.isApiAvailable('shareTargetPicker')) {
                try {
                    await liff.shareTargetPicker([
                        {
                            type: 'text',
                            text: `üèóÔ∏è ‡πÉ‡∏ä‡πâ Crane System ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏¢‡∏Å\n\n` +
                                  `‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏ô ‡∏î‡∏π‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡πÜ\n` +
                                  `‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏¢! üëá\n` +
                                  `https://liff.line.me/${liff.getContext().liffId}`
                        }
                    ]);
                } catch (error) {
                    console.log('‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå');
                }
            } else {
                alert('‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
            }
        }

        // ‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
        async function submitJob(event) {
            event.preventDefault();
            
            const jobName = document.getElementById('jobName').value;
            const jobWeight = document.getElementById('jobWeight').value;
            const jobType = document.getElementById('jobType').value;
            const jobNote = document.getElementById('jobNote').value;

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
            const newJob = {
                id: 'J' + (jobs.length + 1),
                name: jobName,
                weight: jobWeight,
                type: jobType,
                note: jobNote,
                user: userProfile.displayName,
                timestamp: new Date().toLocaleString('th-TH'),
                status: 'pending'
            };

            jobs.unshift(newJob);
            updateJobList();
            
            // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
            const message = `üìã ‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà!\n\n` +
                          `‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô: ${jobName}\n` +
                          `‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å: ${jobWeight} ‡∏ï‡∏±‡∏ô\n` +
                          `‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${getJobTypeText(jobType)}\n` +
                          `‡∏ú‡∏π‡πâ‡∏Ç‡∏≠: ${userProfile.displayName}\n` +
                          `‡πÄ‡∏ß‡∏•‡∏≤: ${newJob.timestamp}` +
                          (jobNote ? `\n‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${jobNote}` : '');
            
            await sendMessage(message);
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
            event.target.reset();
            
            alert('‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏¢‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô
        function updateJobList() {
            const container = document.getElementById('recentJobs');
            
            if (jobs.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô</div>';
                return;
            }
            
            container.innerHTML = jobs.slice(0, 3).map(job => `
                <div class="job-item">
                    <div style="font-weight: bold;">${job.name}</div>
                    <div style="color: #666; font-size: 14px;">
                        ${job.weight} ‡∏ï‡∏±‡∏ô ‚Ä¢ ${getJobTypeText(job.type)}
                    </div>
                    <div style="color: #999; font-size: 12px;">
                        ${job.timestamp} ‚Ä¢ 
                        <span class="status-${job.status}">
                            ${job.status === 'pending' ? '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£' : '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô'}
                        </span>
                    </div>
                </div>
            `).join('');
        }

        // ‡πÅ‡∏õ‡∏•‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô
        function getJobTypeText(type) {
            const types = {
                'steel': '‡∏á‡∏≤‡∏ô‡πÄ‡∏´‡∏•‡πá‡∏Å',
                'concrete': '‡∏á‡∏≤‡∏ô‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï', 
                'equipment': '‡∏¢‡πâ‡∏≤‡∏¢‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå'
            };
            return types[type] || type;
        }

        // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        async function sendMessage(message) {
            if (liff.isInClient()) {
                try {
                    await liff.sendMessages([{ type: 'text', text: message }]);
                } catch (error) {
                    console.error('‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', error);
                }
            } else {
                alert(message);
            }
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
        document.addEventListener('DOMContentLoaded', initializeLiff);
    </script>
</body>
</html>
